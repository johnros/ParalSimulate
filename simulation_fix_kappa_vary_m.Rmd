---
title: "Fix kapa (high dim)"
author: "Jonathan Rosenblatt"
date: "13/1/2014"
output: html_document
---

## Initializing and testing
```{r Initializing}
## for hezi-rack: 
# .libPaths('~/R/x86_64-unknown-linux-gnu-library/')
library(InformationAndInference)
```



## OLS
```{r OLS testing}
configurations <- makeConfiguration_fixKappa(reps = 2e1, m = c(5e0, 5e1), n = c(1.5e2, 1e3) , kappa = 0.1, model = my.ols, link = identity, sigma = 1e1, beta.maker = makeBetasRandom, beta.star.maker = BetaStarIdentity, data.maker = makeRegressionData, truth.fun = truthOLS) 
configurations %>% dim
.MSEs.0 <- apply(configurations, 1, replicateMSE)
MSEs.framed.0 <- frameMSEs_fixKappa(.MSEs.0, configurations)
MSEs.framed.0 %>% select(n, p, m, average, truth)
plotMSEs_fixKappa(MSEs.framed.0, 'test', y.lim=c(0.9,2))
```


```{r  OLS run}
configurations <- makeConfiguration_fixKappa(reps = 5e1, m = c(5e0, 5e1), n = c(1.5e2, 2e2, 4e2) , kappa = c(0.1,0.5,0.9), lambda = 10, model = my.ols, link = identity, sigma = 1e1, beta.maker = makeBetasDeterministic, beta.star.maker = BetaStarIdentity, data.maker = makeRegressionData) 

cl <- makeCluster(30)
clusterEvalQ(cl, {
  .libPaths('~/R/x86_64-unknown-linux-gnu-library/')
  library(InformationAndInference)
  })
MSEs.0 <- parApply(cl, configurations, 1, replicateMSE)
stopCluster(cl)
```

```{r OLS saving}
save(MSEs.0, configurations, file='RData/MSEs.0.RData')
``

```{r OLS plot, eval=FALSE, echo=FALSE}
MSEs.framed.0 <- frameMSEs(MSEs.0, configurations)
plotMSEs(MSEs.framed.0, 'test')
```




## Ridge
```{r Ridge testing}
configurations.1 <- makeConfiguration_fixKappa(reps = 2e1, m = c(5e0, 5e1), n = c(1.5e2, 5e2, 1e3) , kappa = 0.1, lambda = 20, model = my.ridge, link = identity, sigma = 1e1, beta.maker = makeBetasRandom, beta.star.maker = BetaStarRidge, data.maker = makeRegressionData) 
configurations.1 %>% dim
.MSEs.1 <- apply(configurations.1, 1, replicateMSE)
MSEs.framed.1 <- frameMSEs_fixKappa(.MSEs.1, configurations.1)
MSEs.framed.1 %>% select(n, p, m, average, truth)
plotMSEs_fixKappa(MSEs.framed.1, 'test', y.lim=c(0.9,2))
```



```{r ridge run}
sconfigurations.1 <- makeConfiguration(
  reps = 1e2,
  m = c(1e1, 1e2), 
  p = c(5e1, 1e2), 
  n = seq(2e2, 1e3,length.out=5), 
  kappa = 5e-1, model = my.ols, link = identity, sigma = 1e1 ) 

cl <- makeCluster(30)
clusterEvalQ(cl, {
  .libPaths('~/R/x86_64-unknown-linux-gnu-library/')
  library(InformationAndInference)
  })
MSEs.1 <- parApply(cl, configurations.1, 1, replicateMSE)
save(MSEs.1, configurations.1, file='RData/MSEs.1.RData')
stopCluster(cl)
```




## Non Linear
```{r nonlinear test}
configurations <- makeConfiguration_fixKappa(reps = 1e1, m = c(5e0, 2e1), kappa = 0.5, n = c(2e2, 4e2), lambda = NA, model = my.log.link, link = exp, sigma = 1e0, beta.maker = makeBetasRandom, beta.star.maker = BetaStarIdentity, data.maker = makeRegressionData) 
configurations %>% dim
.MSEs.3 <- apply(configurations, 1, replicateMSE)
# cl <- makeCluster(3)
# clusterEvalQ(cl, library(InformationAndInference))
# .MSEs.3 <- parApply(cl, configurations, 1, replicateMSE)
# stopCluster(cl)
MSEs.framed.3 <- frameMSEs_fixKappa(.MSEs.3, configurations)
MSEs.framed.3 %>% select(n, average, p, m, kappa)
plotMSEs_fixKappa(MSEs.framed.3, 'test', y.lim=c(0.8,20))
```


```{r nonlinear run}
configurations.3 <- makeConfiguration(reps = 1e2, m = c(5e0, 5e1), p = 5e1, n = seq(1e2, 2e2, length.out=5), kappa = 1, lambda = NA, model = my.log.link, link = exp, sigma = 1, beta.maker = makeBetasRandom, beta.star.maker = BetaStarIdentity) 
cl <- makeCluster(min(30, nrow(configurations.3)))
clusterEvalQ(cl, {
  library(InformationAndInference)
  })
MSEs.3 <- parApply(cl, configurations.3, 1, replicateMSE)
stopCluster(cl)
```

```{r nonlinear save}
save(MSEs.3, configurations.3, file='RData/MSEs.3.RData')
```

```{r nonlinear plot, eval=FALSE, echo=FALSE}
load(file='RData/MSEs.3.RData')
MSEs.framed.3 <- frameMSEs(MSEs.3, configurations.3)
MSEs.framed.3 %>% select(n, average, std.dev, median, mad) %>% head
plotMSEs(MSEs.framed.3, 'test', robust=TRUE)
```




## Logistic Regression
```{r logistic test}
configurations <- makeConfiguration_fixKappa(reps = 1e1, m = c(5e0, 2e1), n = seq(1e2, 5e2, length.out = 2), kappa=0.1, model = my.logistic, link = sigmoid, sigma = 1e1, beta.maker =makeBetasRandom, beta.star.maker = BetaStarIdentity, data.maker = makeClassificationData) 
configurations %>% dim
.MSEs.4 <- apply(configurations, 1, replicateMSE)
# cl <- makeCluster(3)
# clusterEvalQ(cl, library(InformationAndInference))
# .MSEs.4 <- parApply(cl, configurations, 1, replicateMSE)
# stopCluster(cl)
MSEs.framed.4 <- frameMSEs_fixKappa(.MSEs.4, configurations)
MSEs.framed.4 %>% select(n, p, m, N, average)
plotMSEs(MSEs.framed.4, 'test', y.lim=c(0.8,40), robust = TRUE)
```



```{r logistic run}
configurations.4<- makeConfiguration(reps = 1e1, m = c(5e0, 5e1), p = 1e2, n = seq(1e2, 1e3, length.out = 4), model = my.logistic, link = sigmoid, sigma = 1e1, beta.maker =makeBetasRandom, beta.star.maker = BetaStarIdentity, data.maker = makeClassificationData) 
cl <- makeCluster(min(30, nrow(configurations.4)))
clusterEvalQ(cl, {
  .libPaths('~/R/x86_64-unknown-linux-gnu-library/')
  library(InformationAndInference)
  })
MSEs.4 <- parApply(cl, configurations.4, 1, replicateMSE)
stopCluster(cl)
```

```{r logistic save}
save(MSEs.4, configurations.4, file='RData/MSEs.4.RData')
```

```{r logistic plot, eval=FALSE, echo=FALSE}
MSEs.framed.4 <- frameMSEs(MSEs.4, configurations.4)
plotMSEs(MSEs.framed.4, 'test', robust=TRUE)
```


